- name: Ensure MetalLB namespace exist
  kubernetes.core.k8s:
    api_version: v1
    kind: Namespace
    name: 'metallb-system'
    state: present

- name: Add labels to MetalLB namespace
  kubernetes.core.k8s:
    state: patched
    kind: Namespace
    name: 'metallb-system'
    definition:
      metadata:
        labels:
          pod-security.kubernetes.io/enforce: privileged
          pod-security.kubernetes.io/audit: privileged
          pod-security.kubernetes.io/warn: privileged

- name: Create MetalLB IPAddressPool
  kubernetes.core.k8s:
    definition: '{{ role_path }}/files/ipaddresspool.yaml'
